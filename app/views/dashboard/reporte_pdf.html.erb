<div class="header">
  <h1>ðŸŒž <%= reporte[:titulo] %></h1>
  <p>Generado: <%= fecha_generacion %> | Total registros: <%= reporte[:total_registros] %></p>
</div>

<!-- Resumen Total -->
<div class="section">
  <h2>ðŸ“Š Resumen Total</h2>
  <div class="summary-grid">
    <div class="summary-row">
      <div class="summary-cell summary-header">Concepto</div>
      <div class="summary-cell summary-header">Sin IVA</div>
      <div class="summary-cell summary-header">Con IVA</div>
    </div>
    <div class="summary-row">
      <div class="summary-cell">CFE Sin Sistema Solar</div>
      <div class="summary-cell summary-value neutral">$<%= number_with_delimiter(totales[:cfe_sin_solar], delimiter: ',') %></div>
      <div class="summary-cell summary-value neutral">$<%= number_with_delimiter(totales[:cfe_sin_solar_total], delimiter: ',') %></div>
    </div>
    <div class="summary-row">
      <div class="summary-cell">CFE Con Sistema Solar</div>
      <div class="summary-cell summary-value neutral">$<%= number_with_delimiter(totales[:cfe_con_solar], delimiter: ',') %></div>
      <div class="summary-cell summary-value neutral">$<%= number_with_delimiter(totales[:cfe_con_solar_total], delimiter: ',') %></div>
    </div>
    <div class="summary-row">
      <div class="summary-cell">Ahorro Antes de Pago</div>
      <div class="summary-cell summary-value positive">$<%= number_with_delimiter(totales[:ahorro_antes_pago], delimiter: ',') %></div>
      <div class="summary-cell summary-value positive">$<%= number_with_delimiter(totales[:ahorro_antes_pago_total], delimiter: ',') %></div>
    </div>
    <div class="summary-row">
      <div class="summary-cell">Mensualidad Solara</div>
      <div class="summary-cell summary-value warning">$<%= number_with_delimiter(totales[:mensualidad_solara], delimiter: ',') %></div>
      <div class="summary-cell summary-value warning">$<%= number_with_delimiter(totales[:mensualidad_solara_total], delimiter: ',') %></div>
    </div>
    <div class="summary-row">
      <div class="summary-cell"><strong>AHORRO NETO FINAL</strong></div>
      <div class="summary-cell summary-value <%= totales[:ahorro_final] >= 0 ? 'positive' : 'negative' %>">
        <strong>$<%= number_with_delimiter(totales[:ahorro_final], delimiter: ',') %></strong>
      </div>
      <div class="summary-cell summary-value <%= totales[:ahorro_final_total] >= 0 ? 'positive' : 'negative' %>">
        <strong>$<%= number_with_delimiter(totales[:ahorro_final_total], delimiter: ',') %></strong>
      </div>
    </div>
  </div>
</div>

<!-- Tabla de registros simplificada -->
<% if reporte[:data].any? %>
<div class="section page-break">
  <h2>ðŸ“‹ Detalle de Registros</h2>
  <table class="systems-table">
    <thead>
      <tr>
        <th>Sistema</th>
        <th>Fecha</th>
        <th>PerÃ­odo</th>
        <th>CFE Sin Solar</th>
        <th>CFE Con Solar</th>
        <th>Ahorro Final</th>
      </tr>
    </thead>
    <tbody>
      <% reporte[:data].each do |record| %>
        <tr>
          <td><%= record.sistema %></td>
          <td><%= record.fecha&.strftime("%d/%m/%Y") %></td>
          <td><%= record.periodo %></td>
          <td>$<%= number_with_delimiter(record.cfe_sin_solar_total, delimiter: ',') %></td>
          <td>$<%= number_with_delimiter(record.cfe_con_solar_total, delimiter: ',') %></td>
          <td class="<%= record.ahorro_final_total >= 0 ? 'positive' : 'negative' %>">
            $<%= number_with_delimiter(record.ahorro_final_total, delimiter: ',') %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<% end %>
